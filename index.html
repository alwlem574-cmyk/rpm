<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <title>RPM — Workshop ERP</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./icon-192.png">

  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>

  <div id="toastHost" class="toast-host" aria-live="polite" aria-atomic="true"></div>

  <div id="modalHost" class="modal-host hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title" id="modalTitle">—</div>
        <button class="icon-btn" id="modalClose" aria-label="إغلاق">✕</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-foot" id="modalFoot"></div>
    </div>
  </div>

  <!-- Auth -->
  <main id="authScreen" class="auth">
    <div class="auth-card">
      <div class="brand">
        <div class="logo">RPM</div>
        <div>
          <div class="brand-title">RPM — Workshop ERP</div>
          <div class="brand-sub">Firebase Auth + Firestore • واجهة حديثة</div>
        </div>
      </div>

      <div class="auth-grid">
        <section class="auth-panel">
          <div class="panel-title">تسجيل الدخول</div>
          <label class="field">
            <span>الإيميل</span>
            <input id="loginEmail" type="email" placeholder="name@example.com" autocomplete="username">
          </label>
          <label class="field">
            <span>كلمة المرور</span>
            <input id="loginPass" type="password" placeholder="••••••••" autocomplete="current-password">
          </label>
          <button id="btnLogin" class="btn primary w100">دخول</button>

          <div class="hint">
            أول مرة؟ سجّلي بحسابك، وبعدها اضغطي <b>ترقية حسابي لأدمن</b> (مرة واحدة) حتى تفتح الإدارة.
          </div>

          <div class="divider"></div>

          <button id="btnOfflineInfo" class="btn ghost w100">PWA / Offline</button>
        </section>

        <section class="auth-panel">
          <div class="panel-title">حالة النظام</div>
          <div class="mini-cards">
            <div class="mini-card">
              <div class="mini-k">Firebase</div>
              <div class="mini-v" id="firebaseStatus">—</div>
            </div>
            <div class="mini-card">
              <div class="mini-k">الدور</div>
              <div class="mini-v" id="roleBadge">—</div>
            </div>
            <div class="mini-card">
              <div class="mini-k">Build</div>
              <div class="mini-v">Modern Dark • v1</div>
            </div>
          </div>

          <div class="auth-actions">
            <button id="btnMakeMeAdmin" class="btn warn">ترقية حسابي لأدمن</button>
            <button id="btnSeedDemo" class="btn ghost">بيانات تجريبية</button>
          </div>

          <div class="hint">
            Collections: <b>cars</b>, <b>customers</b>, <b>orders</b>, <b>invoices</b>, <b>inventory</b>, <b>invoiceTemplates</b>, <b>uiPages</b>, <b>settings</b>, <b>users</b>, <b>employees</b>, <b>meta</b>.
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- App -->
  <div id="appShell" class="app hidden">
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-top">
        <button id="btnToggleSidebar" class="icon-btn" title="طي/فتح">☰</button>
        <div class="sidebar-brand">
          <div class="logo sm">RPM</div>
          <div class="sidebar-meta">
            <div class="sidebar-title">Workshop ERP</div>
            <div class="sidebar-sub" id="shopNameBadge">—</div>
          </div>
        </div>
      </div>

      <div class="sidebar-search">
        <input id="navSearch" type="search" placeholder="بحث بالصفحات…" />
      </div>

      <nav id="nav" class="nav"></nav>

      <div class="sidebar-foot">
        <div class="user-chip">
          <div class="avatar" id="userAvatar">U</div>
          <div class="user-chip-meta">
            <div class="user-chip-name" id="userName">—</div>
            <div class="user-chip-sub">
              <span class="pill" id="userRole">—</span>
              <span class="pill" id="netState">—</span>
            </div>
          </div>
        </div>
        <button id="btnSignOut" class="btn danger w100">خروج</button>
      </div>
    </aside>

    <section class="main">
      <header class="topbar">
        <div>
          <div class="crumbs" id="crumbs">الرئيسية</div>
          <div class="page-title" id="pageTitle">—</div>
        </div>

        <div class="topbar-right">
          <div class="kbar">
            <input id="globalSearch" type="search" placeholder="بحث سريع (Ctrl+K)" />
            <kbd class="kbd">Ctrl</kbd><kbd class="kbd">K</kbd>
          </div>
          <button id="btnQuickAdd" class="btn primary">إضافة سريعة</button>
          <button id="btnUpdates" class="btn ghost hidden">تحديث متوفر</button>
        </div>
      </header>

      <main id="view" class="view"></main>

      <footer class="foot">
        <div>RPM • Frontend-only • Firestore</div>
        <div class="foot-links">
          <button class="link" id="btnAbout">حول</button>
        </div>
      </footer>
    </section>
  </div>

  <iframe id="printFrame" class="print-frame" title="print"></iframe>

  <script type="module" src="./app.js"></script>
</body>
</html>
